@model Product
@{
    var userId = Context.Session.GetInt32("UserId");
    var userName = Context.Session.GetString("UserName") ?? "";
    var userAddress = Context.Session.GetString("UserAddress") ?? "";
    var userPhone = Context.Session.GetString("UserPhone") ?? "";
}

    <div class="container mt-5">
        <div class="row">
            <!-- Ảnh sản phẩm -->
            <div class="col-lg-6 col-md-12 text-center">
                <img src="@Model.ImageUrl" class="img-fluid product-image">
            </div>

            <!-- Mô tả sản phẩm -->
            <div class="col-lg-6 col-md-12">
                <h2>@Model.Name</h2>
                <p class="text-muted">Mã sản phẩm: @Model.Description</p>

                <!-- Đánh giá sao -->
                <div class="mb-2">
                    <span class="star"><i class="bi bi-star-fill"></i></span>
                    <span class="star"><i class="bi bi-star-fill"></i></span>
                    <span class="star"><i class="bi bi-star-fill"></i></span>
                    <span class="star"><i class="bi bi-star-fill"></i></span>
                    <span class="star text-muted"><i class="bi bi-star"></i></span>
                    <span>(987 lượt đánh giá)</span>
                </div>

                <!-- Giá -->
                <h4 class="text-danger">@Model.Price.ToString("N0") đ</h4>

                <!-- Chọn kích thước -->
                <div class="mt-3">
                    <h6>Kích thước:</h6>
                    <div class="d-flex flex-wrap">
                        <span class="size-option">39</span>
                        <span class="size-option">40</span>
                        <span class="size-option">41</span>
                        <span class="size-option">42</span>
                        <span class="size-option">43</span>
                    </div>
                </div>

                <!-- Nút hành động -->
                <div class="mt-4 text-center text-md-start">
                    <button class="btn btn-danger btn-lg me-3" data-bs-toggle="modal" data-bs-target="#orderModal" ">Mua ngay</button>
                    <button class="btn btn-outline-danger btn-lg" onclick="addToCart(@Model.Id)">
                        <i class="bi bi-cart4"></i> Thêm vào giỏ hàng
                    </button>
                </div>

                <!-- Thông tin khác -->
                <ul class="mt-4 list-unstyled">
                    <li><i class="bi bi-check-circle tick"></i> Bảo hành keo vĩnh viễn</li>
                    <li><i class="bi bi-truck tick"></i> Miễn phí vận chuyển đơn hàng từ 150k</li>
                    <li><i class="bi bi-arrow-left-right tick"></i> Đổi trả dễ dàng trong 7 ngày</li>
                </ul>
            </div>
           
        </div>
        <!-- Modal chứa form đặt hàng -->
        <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" data-bs-backdrop="static" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="orderModalLabel">Thông tin đặt hàng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                    <form id="orderForm">
                        <input type="hidden" name="UserId" value="@userId" />
                        <input type="hidden" name="ProductId" value="@Model.Id" />
                        <input type="hidden" name="Price" value="@Model.Price" />
                        <div class="mb-3">
                            <label>Họ tên</label>
                            <input type="text" name="Name" class="form-control" value="@userName" required />
                        </div>
                        <div class="mb-3">
                            <label>Địa chỉ</label>
                            <input type="text" name="Address" class="form-control" value="@userAddress" required />
                        </div>
                        <div class="mb-3">
                            <label>Số điện thoại</label>
                            <input type="text" name="Phone" class="form-control" value="@userPhone" required />
                        </div>
                        <div class="mb-3">
                            <label>Phương thức thanh toán:</label><br>
                            <input type="radio" name="PaymentMethod" value="COD" checked /> Thanh toán khi nhận hàng
                            <input type="radio" name="PaymentMethod" value="Bank" /> Chuyển khoản
                        </div>
                        <button type="submit" class="btn btn-success " >Đặt hàng</button>
                    </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

<script>
        document.getElementById("orderForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Ngăn chặn reload trang

        const productId = document.querySelector("input[name='ProductId']").value;
        const price = document.querySelector("input[name='Price']").value;

        fetch('/Order/PlaceOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ProductId: productId,
                Price: price
            })
        })
        .then(response => response.json())
        .then(data => {
            // showToast(data.message, data.success ? 'success' : 'danger');
            

            if (data.success) {
                
                //Ẩn modal sau khi đặt hàng thành công
                const orderModal = new bootstrap.Modal(document.getElementById("orderModal"));
                orderModal.hide();
            }
        })
        .catch(error => console.error('Lỗi:', error));
    });
               
       
        
</script>
    <script>
        function addToCart(productId) {
            fetch(`/Cart/AddToCart?productId=${productId}`)
                .then(response => response.json())
                .then(data => alert(data.message))
                .catch(error => console.error('Error:', error));
        }
    </script>
    

